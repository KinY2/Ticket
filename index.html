<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Virtual Ticket Slide</title>

<!-- Google Font: Roboto -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">

<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Roboto', sans-serif;
    background-color: #1a1a1a;
    overflow-x: hidden;
  }

  .ticket {
    position: absolute;
    right: -100%; /* start off-screen */
    top: -100%;
    transform: translateY(-50%);
    height: 80vh;
    aspect-ratio: 3 / 1;
    transform-origin: right center;
    background: url('ticket.png') no-repeat center center;
    background-size: cover;
    border-radius: 10px;
    display: flex; /* keep it visible for animation */
    align-items: center;
    justify-content: center;
    font-size: 4vw;
    font-weight: bold;
    color: #000;
  }

  #seatDisplay {
    position: absolute;
    top: 75%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 4vh;
    color: white;
    display: none;
  }

  #generateBtn {
    display: block; /* button visible from start */
    position: absolute;
    top: 50%;
    left: 40%;
    transform: translateY(-50%);
    padding: 12px 24px;
    font-size: 4vh;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  @keyframes slideAndRotate {
    0% {top: 10%; right: -100%; transform: rotate(0deg) scale(1); }
    50% {right: -30%;}
    70% { top: 10%; right: 30%; transform: rotate(0deg);}
    100% { right: 50%; top: 50%; transform: rotate(90deg); }
  }

  .animateTicket {
    animation: slideAndRotate 3s ease forwards;
  }
</style>
</head>
<body>

<div class="ticket" id="ticketDisplay"></div>
<div id="seatDisplay"></div>
<button id="generateBtn">Click!</button>

<script>
const ticketDiv = document.getElementById('ticketDisplay');
const seatDiv = document.getElementById('seatDisplay');
const button = document.getElementById('generateBtn');

button.addEventListener('click', async () => {
  button.style.display = 'none';

  // Start animation
  ticketDiv.classList.add('animateTicket');

  setTimeout(() => {
    ticketDiv.style.animationPlayState = 'paused';
  }, 1500);

  // Fetch seat from Google Sheets
  let seatText = '';
  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbxolmsKQto0Z75AY-OZs_5Ai1aCyYFUCTCR3w7MykJejKOcWunUSCpQOpVUZj1YEJeA/exec");
    const data = await response.json();
    seatText = data.seat || 'Fini :(';
  } catch (err) {
    seatText = 'Error fetching seat';
    console.error(err);
  }

  // Resume animation to finish remaining 70%
  ticketDiv.style.animationPlayState = 'running';

  // Show text only after animation completes
  ticketDiv.addEventListener('animationend', () => {
    seatDiv.innerText = seatText;
    seatDiv.style.display = 'block';
  }, { once: true });
});
</script>

</body>
</html>
